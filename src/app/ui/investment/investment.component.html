<div class="container" *ngIf="project != null">
    <div class="row">
        <h2 class="component-title">
            Investment
        </h2>
    </div>
    <div class="row" *ngIf="project.reached">
        <div class="col">
            <div class="alert alert-success w-100" role="alert">
                Investment has been successfully funded.
            </div>
        </div>
    </div>
    <div class="row" *ngIf="!project.reached && projectState">
        <div class="col">
            <div class="alert alert-warning w-100" role="alert">
                Investment is close to completion.
            </div>
        </div>
    </div>
    <div class="row" *ngIf="!project.reached && !projectState">
        <div class="col">
            <div class="alert alert-info w-100" role="alert">
                Investment is still in progress.
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-8">
            <img class="rounded mx-auto d-block img-preview" [src]="safeUrl">
        </div>
        <div class="col-md-4">
            <div class="creator">
                <img class="rounded-circle" src="http://via.placeholder.com/65x65">
                <span class="creator-text margin-text-left">{{(creator$ | async)?.firstname}} {{(creator$ | async)?.lastname}}</span>
            </div>
            <div class="funding">
                <div class="raised-goal-container">
                    <span>
                      <span class="raised-text">Raised: </span>
                      <span class="raised-value">{{project.investedIn}}€</span>
                    </span>
                    <span>
                      <span class="goal-text">Goal: </span>
                      <span class="goal-value">{{project.goal}}€</span>
                    </span>
                </div>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" [style.width.%]="calculatePercent(project)">{{((project.investedIn / project.goal) * 100)}}%</div>
                </div>
                <button type="button" class="btn btn-outline-primary custom-button" (click)="editProject(project)" *ngIf="isOwner(project)">Edit</button>
                <button type="button" class="btn btn-outline-primary custom-button" (click)="deleteProject(project)" *ngIf="isOwner(project)">Delete</button>
                <div class="form-group">
                    <input class="input" id="inputInvest" type="number" class="form-field" placeholder=" " (focusout)="focusoutHandler($event)">
                    <label for="inputInvest" class="form-label">Invest</label>
                    <span class="required" *ngIf="isInvestThere != null && !isInvestThere"> This field is required/unvalid</span>
                </div>
                <button type="button" class="btn btn-outline-primary custom-button" (click)="investInto(project)">Invest</button>
                <p class="margin-text-top success" *ngIf="hasInvested != undefined && hasInvested">Successfully invested</p>
                <p class="margin-text-top failure" *ngIf="hasInvested != undefined && !hasInvested">Failed to invest. {{errorString}}</p>
                <button type="button" class="btn btn-outline-primary custom-button" (click)="removeInvestment(project)" *ngIf="(invested$ | async) > 0">Remove {{invested$ | async}}€</button>
            </div>
        </div>
    </div>
    <div class="row margin-text-top">
        <div class="col-md-8">
            <h1 class="title">{{project.title}}</h1>
            <p class="desc">{{project.description}}</p>
        </div>
        <div class="col-md-4">
            <h3>Comments</h3>
            <div class="form-group">
                <textarea id="inputComment" class="form-field" placeholder=" " rows="3" (focusout)="focusoutHandler($event)"></textarea>
                <label for="inputComment" class="form-label">Comment</label>
            </div>
            <button type="button" class="btn btn-outline-primary custom-button" (click)="commentProject(project)">Comment</button>
            <div class="comment" *ngFor="let comment of comments; index as i">
                <img class="rounded-circle" src="http://via.placeholder.com/35x35">
                <span class="comment-creator margin-text-left">{{(commentEmployees$[i] | async)?.firstname}} {{(commentEmployees$[i] | async)?.lastname}}</span>
                <p class="comment-text">{{comment.text}}</p>
            </div>
            <hr>
        </div>
    </div>
</div>

<div class="container text-center align-middle margin-text-top" *ngIf="!doesExist">
    <div class="row">
        <h1>Investment does not exist or you are not permitted to view.</h1>
    </div>
</div>